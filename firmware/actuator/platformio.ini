; PlatformIO Configuration for Actuator Controller
; ================================================
;
; ATtiny3226 MCU for closed-loop rudder control with:
; - Rudder position sensing (ADC)
; - PWM motor control (H-Bridge)
; - Electromagnetic clutch control
; - Current/voltage monitoring (INA219 I2C or direct ADC)
; - Serial communication with Raspberry Pi
;
; Current Sensing Options:
;   CURRENT_SENSE_INA219 - INA219 I2C module (recommended, default)
;   CURRENT_SENSE_ADC    - Direct ADC with shunt + op-amp
;
; Build environments:
;   pio run -e attiny3226          # INA219 (default)
;   pio run -e attiny3226_adc      # Direct ADC
;   pio run -e attiny3224          # INA219 on smaller chip
;   pio run -e attiny3224_adc      # Direct ADC on smaller chip

; Common settings
[common]
platform = atmelmegaavr
framework = arduino
upload_protocol = serialupdi
upload_port = /dev/ttyUSB0
upload_speed = 115200
monitor_speed = 115200
monitor_filters = direct

base_build_flags = 
    -DSERIAL_OUTPUT_RATE_HZ=20
    -DCONTROL_LOOP_RATE_HZ=50
    -DWATCHDOG_TIMEOUT_MS=2000
    -DCURRENT_LIMIT_SOFT=12.0
    -DCURRENT_LIMIT_HARD=15.0
    -DPOSITION_LIMIT_DEG=28.0

ina219_flags = 
    -DCURRENT_SENSE_INA219
    -DINA219_I2C_ADDRESS=0x40
    -DINA219_SHUNT_OHMS=0.01
    -DINA219_MAX_CURRENT=20.0

adc_flags = 
    -DCURRENT_SENSE_ADC

; ============================================================================
; ATtiny3226 with INA219 (recommended)
; ============================================================================
[env:attiny3226]
extends = common
board = ATtiny3226
build_flags = 
    ${common.base_build_flags}
    ${common.ina219_flags}
lib_deps = 
    Wire

; ============================================================================
; ATtiny3226 with direct ADC current sensing
; ============================================================================
[env:attiny3226_adc]
extends = common
board = ATtiny3226
build_flags = 
    ${common.base_build_flags}
    ${common.adc_flags}

; ============================================================================
; ATtiny3224 with INA219 (smaller package)
; ============================================================================
[env:attiny3224]
extends = common
board = ATtiny3224
build_flags = 
    ${common.base_build_flags}
    ${common.ina219_flags}
lib_deps = 
    Wire

; ============================================================================
; ATtiny3224 with direct ADC current sensing
; ============================================================================
[env:attiny3224_adc]
extends = common
board = ATtiny3224
build_flags = 
    ${common.base_build_flags}
    ${common.adc_flags}
