; IMU Sensor Fusion MCU Firmware
; ================================
; 
; ATtiny3226-based IMU processor with ICM-20948
; Runs Madgwick AHRS filter and outputs fused orientation via serial
;
; Based on platformio configuration from N2KEngine project

[platformio]
default_envs = attiny3226

[env:attiny3226]
platform = atmelmegaavr
platform_packages = 
    platformio/framework-arduino-megaavr-megatinycore@2.6.8
board = attiny3226
framework = arduino
lib_ldf_mode = deep

; Serial port for programming (adjust to your port)
upload_port = /dev/cu.usbserial-5
monitor_port = /dev/cu.usbserial-A50285BI
monitor_speed = 115200

; Clock speed - 16MHz for smooth timing
board_build.f_cpu = 16000000L

build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3226
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=100
    -D DEBUG_EN=0
    -Os
    !echo '#define GIT_SHA1_VERSION "'$$(git log --pretty=format:'%h' -1 2>/dev/null || echo 'unknown')'"' > src/version.h

; Upload using jtag2updi programmer
upload_flags = 
    -P 
    $UPLOAD_PORT
    -b 
    $UPLOAD_SPEED
    -C 
    /Users/ieb/timefields/PlatformIO/Projects/jtag2updi/avrdude.conf
    -p 
    t3226

lib_deps = 
    ; Using local MadgwickAHRS implementation (in lib/)
    ; ICM20948 driver included locally for ATtiny compatibility


; Development environment with debug output
[env:attiny3226_debug]
extends = env:attiny3226
build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3226
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=50
    -D DEBUG_EN=1
    -Os
    !echo '#define GIT_SHA1_VERSION "'$$(git log --pretty=format:'%h' -1 2>/dev/null || echo 'unknown')'"' > src/version.h
