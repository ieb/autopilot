; IMU Sensor Fusion MCU Firmware
; ================================
; 
; ATtiny3224-based IMU processor with ICM-20948
; Runs Madgwick AHRS filter and outputs fused orientation via serial
;
; Based on platformio configuration from N2KEngine project
;
; ATtiny3224 (14-pin) vs ATtiny3226 (20-pin):
;   - Same flash (32KB), RAM (3KB), EEPROM (256B)
;   - Same peripherals (TWI, USART, etc.)
;   - ATtiny3224 has PA0-PA3, PB0-PB3 only (no PA4-PA7)

[platformio]
default_envs = attiny3224

; =============================================================================
; ATtiny3224 (14-pin) - Primary target
; =============================================================================
[env:attiny3224]
platform = atmelmegaavr
platform_packages = 
    framework-arduino-megaavr-megatinycore @ https://github.com/SpenceKonde/megaTinyCore.git
board = attiny3224
framework = arduino
lib_ldf_mode = deep

; Serial port for programming (adjust to your port)
upload_port = /dev/cu.usbserial-5
monitor_port = /dev/cu.usbserial-A50285BI
monitor_speed = 115200

; Clock speed - 16MHz for smooth timing
board_build.f_cpu = 16000000L

build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3224
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=100
    -D DEBUG_EN=0
    -Os

; Upload using jtag2updi programmer
upload_flags = 
    -P 
    $UPLOAD_PORT
    -b 
    $UPLOAD_SPEED
    -p 
    t3224

lib_deps = 
    ; Using local MadgwickAHRS implementation (in lib/)
    ; ICM20948 driver included locally for ATtiny compatibility


; ATtiny3224 with debug output
[env:attiny3224_debug]
extends = env:attiny3224
build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3224
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=50
    -D DEBUG_EN=1
    -Os


; =============================================================================
; ATtiny3226 (20-pin) - Alternative target
; =============================================================================
[env:attiny3226]
platform = atmelmegaavr
platform_packages = 
    framework-arduino-megaavr-megatinycore @ https://github.com/SpenceKonde/megaTinyCore.git
board = attiny3226
framework = arduino
lib_ldf_mode = deep

; Serial port for programming (adjust to your port)
upload_port = /dev/cu.usbserial-5
monitor_port = /dev/cu.usbserial-A50285BI
monitor_speed = 115200

; Clock speed - 16MHz for smooth timing
board_build.f_cpu = 16000000L

build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3226
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=100
    -D DEBUG_EN=0
    -Os

; Upload using jtag2updi programmer
upload_flags = 
    -P 
    $UPLOAD_PORT
    -b 
    $UPLOAD_SPEED
    -p 
    t3226

lib_deps = 
    ; Using local MadgwickAHRS implementation (in lib/)
    ; ICM20948 driver included locally for ATtiny compatibility


; ATtiny3226 with debug output
[env:attiny3226_debug]
extends = env:attiny3226
build_flags = 
    -D SERIAL_RX_BUFFER_SIZE=64
    -D TARGET_MCU=3226
    -D IMU_UPDATE_RATE_HZ=100
    -D SERIAL_OUTPUT_RATE_HZ=50
    -D DEBUG_EN=1
    -Os
